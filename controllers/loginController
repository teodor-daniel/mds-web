// User model
const User = require("../models/User");

// Controllers
const loginView = (req, res) => res.render("login", {});

const doLogin = (req, res) => {
    const username = req.body.username, password = req.body.password;

    const hash = require('hash.js');
    let hashedPassword = hash.sha256().update(password).digest("hex");

    User.findOne({ username: username, password: hashedPassword }, (err, user) => {
        if (err) {
            res.render("login", { error: err });
        } else {
            if (user) {
                res.render("dashboard", { user: user });
            } else {
                res.render("login", { error: "Invalid username or password!" });
            }
        }
    });
}

module.exports =  {
    loginView,
    doLogin
};